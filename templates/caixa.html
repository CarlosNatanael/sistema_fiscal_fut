{% extends "base.html" %}

{% block content %}
<div class="form-container"> {# Reutilizando o estilo de container #}
    <h2>Caixa do Grupo</h2>

    <div class="caixa-summary">
        <h3>Resumo do Mês Atual ({{ mes_atual_display }})</h3>
        <p><strong>Total Arrecadado (Mensalidades Associados):</strong> R$ {{ "%.2f"|format(total_arrecadado_mes_atual if total_arrecadado_mes_atual is not none else 0) }}</p>
        {# Adicionar aqui total de convidados se implementado #}
    </div>

    <hr>

    <h3>Detalhes dos Pagamentos Recebidos no Mês Atual ({{ mes_atual_display }})</h3>
    {% if pagamentos_recentes %}
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Associado</th>
                    <th>Mês Pago</th>
                    <th>Data do Pagamento</th>
                    <th>Valor Pago (R$)</th>
                </tr>
            </thead>
            <tbody>
                {% for pagamento in pagamentos_recentes %}
                <tr>
                    <td>{{ pagamento.associado.nome }}</td>
                    <td>{{ pagamento.mes|format_mes_display }}</td> {# Filtro para formatar YYYY-MM para MM/YYYY #}
                    <td>{{ pagamento.data_pagamento.strftime('%d/%m/%Y') if pagamento.data_pagamento else '-' }}</td>
                    <td>{{ "%.2f"|format(pagamento.valor if pagamento.valor is not none else 0) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p>Nenhum pagamento registrado como "OK" com valor para este mês.</p>
    {% endif %}

    {# Você pode adicionar uma seção para o histórico completo de todos_pagamentos_historico aqui se desejar #}
    {# Por exemplo:
    <hr>
    <h3>Histórico Completo de Arrecadação (Associados)</h3>
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Associado</th>
                    <th>Mês Pago</th>
                    <th>Data do Pagamento</th>
                    <th>Valor Pago (R$)</th>
                </tr>
            </thead>
            <tbody>
                {% for pagamento_hist in todos_pagamentos_historico %}
                <tr>
                    <td>{{ pagamento_hist.associado.nome }}</td>
                    <td>{{ pagamento_hist.mes|format_mes_display }}</td>
                    <td>{{ pagamento_hist.data_pagamento.strftime('%d/%m/%Y') if pagamento_hist.data_pagamento else '-' }}</td>
                    <td>{{ "%.2f"|format(pagamento_hist.valor if pagamento_hist.valor is not none else 0) }}</td>
                </tr>
                {% else %}
                <tr><td colspan="4">Nenhum pagamento no histórico.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    #}

</div>

{# Adicionar filtro Jinja para formatar o mês se não existir #}
{# No app.py:
def format_mes_para_display(mes_yyyymm):
    if mes_yyyymm:
        try:
            return datetime.strptime(mes_yyyymm, '%Y-%m').strftime('%m/%Y')
        except ValueError:
            return mes_yyyymm # Retorna original se não puder formatar
    return ''
app.jinja_env.filters['format_mes_display'] = format_mes_para_display
#}
{% endblock %}